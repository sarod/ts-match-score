{"version":3,"sources":["utils.ts","colorForScore.tsx","graph/ForceGraph.tsx","state/GraphState.tsx","ScoreBlock.tsx","GraphStateTable.tsx","state/ComputeState.tsx","url/parseUrl.tsx","App.tsx","serviceWorker.ts","index.tsx","url/synchronizeUrl.tsx"],"names":["replaceSearchParams","href","params","newUrl","URL","search","urlParams","URLSearchParams","Object","entries","forEach","_ref","_ref2","slicedToArray","key","value","append","toString","buildQueryString","alphaName","index","String","fromCharCode","charCodeAt","red","tinycolor","hueDelta","toHsv","h","colors","range","map","i","redHsv","objectSpread","toRgbString","colorForScore","score100","rounded","Math","round","nodeRadius","ForceGraph","graphState","_ref$width","width","_ref$height","height","svgRef","useRef","_useState","useState","_useState2","previousGraphData","setPreviousGraphData","graphData","useMemo","oldNodes","keyBy","nodes","n","nodeName","vertexNames","name","node","oldNode","x","y","nbVertex","links","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","score","push","edgeId","vertexName","source","target","err","return","buildGraphData","svgElement","current","useEffect","simulation","d3Force","force","id","distance","link","strength","svgSel","d3Selection","linkSel","attr","selectAll","data","enter","d","text","nodeGroupSel","on","concat","stop","firstChild","removeChild","react_default","a","createElement","ref","GraphState","scoreMatrix","classCallCheck","this","createClass","hgs","vertexNameSet","Set","keys","edgeStr","_parseEdge","parseEdge","_parseEdge2","vertex1","vertex2","add","Array","from","sort","vertexIndexByName","reduce","previous","state","_parseEdge3","_parseEdge4","withScore100","length","withVertexNames","slice","vertexIndex","newScore","Error","matrix","normalized","normalize","newRow","toConsumableArray","newScores","e","console","log","createEmpty","confidenceScore","max","min","edgeScores","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","edge","verticesInEdge","split","ScoreDisplay","number","style","display","textAlign","paddingRight","backgroundColor","color","mostReadable","GraphStateTable","onGraphStateChange","colIndex","rowIndex","TextField","inputProps","step","type","onChange","Number","isNaN","Typography","variant","ScoreBlock_ScoreDisplay","initialState","iterations","computeNextComputeState","computeState","nextIterationIndex","lastIteration","computeNextIteration","needsAnotherIteration","k","newState","j","ijScore","score1","EDGES_PARAM","graphStateFromUrl","window","location","has","fromEdgeScores","JSON","parse","get","DELAY_PARAM","delayFromUrl","AUTO_COMPUTE_PARAM","autoComputeFromUrl","ConfidenceScore","Boolean","hostname","match","ReactDOM","render","_React$useState","React","_React$useState2","autoCompute","setAutoCompute","_React$useState3","_React$useState4","inputState","setInputState","_React$useState5","_React$useState6","toCompute","setToCompute","_React$useState7","_React$useState8","delay","setDelay","_React$useState9","_React$useState10","setComputeState","handleInputStateChange","_searchParams","searchParams","defineProperty","stringify","toEdgeScores","originalHref","newHref","history","pushState","synchronizeUrl","timeoutId","createInitialComputeState","setTimeout","iterate","clearTimeout","className","label","withNbVertex","Button","onClick","withResetedScores","GraphStateTable_GraphStateTable","App_ConfidenceScore","computeConfidenceScore","ForceGraph_ForceGraph","FormControlLabel","control","Checkbox","checked","disabled","_","reverseIndex","iterationState","flexDirection","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.2366d89c.chunk.js","sourcesContent":["export { range } from \"lodash\";\n\nexport type SearchParams = { [param: string]: string };\nexport const buildQueryString = (params: SearchParams) => {\n  const urlParams = new URLSearchParams();\n  Object.entries(params).forEach(([key, value]) =>\n    urlParams.append(key, value)\n  );\n  return urlParams.toString();\n};\n\nexport const replaceSearchParams = (\n  href: string,\n  params: SearchParams\n): string => {\n  const newUrl = new URL(href);\n  newUrl.search = buildQueryString(params);\n  return newUrl.href;\n};\n\nexport const round2Digits = (number: number) => {\n  return Math.round(number * 100) / 100;\n};\n\nexport const alphaName = (index: number) => {\n  return String.fromCharCode(\"A\".charCodeAt(0) + index);\n};\n","import { range } from \"./utils\";\nimport tinycolor from \"tinycolor2\";\nconst red = tinycolor(\"#f44335\");\nconst green = tinycolor(\"#4caf50\");\nconst hueDelta = green.toHsv().h - red.toHsv().h;\nconst colors = range(100).map(i => {\n  const redHsv = red.toHsv();\n  return tinycolor({\n    ...redHsv,\n    h: redHsv.h + (hueDelta * i) / 100\n  }).toRgbString();\n});\n// console.log(\"colors:\", colors, \"hueDelta\", hueDelta);\nexport const colorForScore = (score100: number) => {\n  const rounded = Math.round(score100);\n  if (rounded === 0) {\n    return \"\";\n  }\n  return colors[rounded - 1];\n};\n\nexport const contrastColorForScore = (score100: number) => {\n  return tinycolor\n    .mostReadable(colorForScore(score100), [\"white\", \"black\"])\n    .toString();\n};\n","import \"./ForceGraph.css\";\nimport React, { useEffect, useRef, useMemo, useState } from \"react\";\nimport * as d3Force from \"d3-force\";\nimport { SimulationNodeDatum, SimulationLinkDatum, ForceLink } from \"d3-force\";\nimport * as d3Selection from \"d3-selection\";\n\nimport { GraphState } from \"../state/GraphState\";\nimport { range } from \"../utils\";\nimport { colorForScore } from \"../colorForScore\";\nimport { keyBy } from \"lodash\";\n\ntype NodeDatum = SimulationNodeDatum & {\n  nodeName: string;\n};\n\ntype LinkDatum = SimulationLinkDatum<NodeDatum> & {\n  edgeId: string;\n  score: number;\n};\n\ntype GraphData = {\n  nodes: NodeDatum[];\n  links: LinkDatum[];\n};\n\nconst buildGraphData = (\n  graphState: GraphState,\n  previousGraphData: GraphData | null\n): GraphData => {\n  const oldNodes = keyBy(\n    previousGraphData ? previousGraphData.nodes : [],\n    n => n.nodeName\n  );\n\n  const nodes: NodeDatum[] = graphState.vertexNames.map((name, index) => {\n    const node: NodeDatum = {\n      nodeName: name,\n      index: index\n    };\n    const oldNode = oldNodes[name];\n    if (oldNode) {\n      node.x = oldNode.x;\n      node.y = oldNode.y;\n    }\n    return node;\n  });\n\n  const n = graphState.nbVertex();\n  const links: LinkDatum[] = [];\n  for (let x of range(0, n)) {\n    for (let y of range(x + 1, n)) {\n      const score = graphState.score100(x, y);\n      if (score !== 0) {\n        links.push({\n          edgeId: graphState.vertexName(x) + \"-\" + graphState.vertexName(y),\n          source: graphState.vertexName(x),\n          target: graphState.vertexName(y),\n          score\n        });\n      }\n    }\n  }\n  return { links, nodes };\n};\n\nconst nodeRadius = 20;\nexport const ForceGraph = ({\n  graphState,\n  width = 400,\n  height = 400\n}: {\n  graphState: GraphState;\n  width?: number;\n  height?: number;\n}) => {\n  const svgRef = useRef<SVGSVGElement>(null);\n  let [previousGraphData, setPreviousGraphData] = useState<GraphData | null>(\n    null\n  );\n\n  const graphData = useMemo(\n    () => buildGraphData(graphState, previousGraphData),\n    // previousGraphData is omitied on purpose here... This is a code smell but I can't figure it out\n    [graphState]\n  );\n  if (previousGraphData !== graphData) {\n    setPreviousGraphData(graphData);\n  }\n\n  const svgElement: SVGSVGElement | null = svgRef.current;\n  useEffect(() => {\n    if (svgElement === null) {\n      return;\n    }\n    const simulation = d3Force\n      .forceSimulation<NodeDatum, LinkDatum>()\n      .force(\n        \"link\",\n        d3Force\n          .forceLink()\n          .id((node: SimulationNodeDatum) => (node as NodeDatum).nodeName)\n          .distance(\n            (link: any) => 30 + (1 - (link as LinkDatum).score / 100) * 100\n          )\n      )\n      .force(\"collide\", d3Force.forceCollide(nodeRadius * 1.5))\n      .force(\"charge\", d3Force.forceManyBody().strength(() => -10))\n      .force(\"center\", d3Force.forceCenter(width / 2, height / 2));\n\n    const svgSel = d3Selection.select(svgElement);\n    const linkSel = svgSel\n      .append(\"g\")\n      .attr(\"class\", \"ForceGraph__Links\")\n      .selectAll(\"line\")\n      .data(graphData.links)\n      .enter()\n      .append(\"line\")\n      .attr(\"stroke\", (d: LinkDatum) => colorForScore(d.score));\n    linkSel.append(\"title\").text(function(d: LinkDatum) {\n      return d.edgeId + \": \" + d.score;\n    });\n\n    const nodeGroupSel = svgSel\n      .append(\"g\")\n      .attr(\"class\", \"ForceGraph__Nodes\")\n      .selectAll(\"g\")\n      .data(graphData.nodes)\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"ForceGraph__NodeGroup\");\n\n    nodeGroupSel\n      .append(\"circle\")\n      .attr(\"class\", \"ForceGraph__NodeCircle\")\n      .attr(\"cx\", nodeRadius / 2)\n      .attr(\"cy\", nodeRadius / 2)\n      .attr(\"r\", nodeRadius);\n\n    nodeGroupSel\n      .append(\"text\")\n      .attr(\"class\", \"ForceGraph__NodeText\")\n      .attr(\"x\", nodeRadius / 2)\n      .attr(\"y\", nodeRadius / 2)\n      .text(d => d.nodeName);\n\n    nodeGroupSel.append(\"title\").text(d => d.nodeName);\n    //.call(createDragCall(simulation))\n\n    simulation.nodes(graphData.nodes).on(\"tick\", ticked);\n    const forceLink = simulation.force(\"link\") as d3Force.ForceLink<\n      NodeDatum,\n      LinkDatum\n    >;\n    forceLink.links(graphData.links);\n    function ticked() {\n      linkSel\n        .attr(\"x1\", function(d: LinkDatum) {\n          return (d.source as NodeDatum).x as number;\n        })\n        .attr(\"y1\", function(d: LinkDatum) {\n          return (d.source as NodeDatum).y as number;\n        })\n        .attr(\"x2\", function(d: LinkDatum) {\n          return (d.target as NodeDatum).x as number;\n        })\n        .attr(\"y2\", function(d: LinkDatum) {\n          return (d.target as NodeDatum).y as number;\n        });\n\n      nodeGroupSel.attr(\"transform\", function(d: NodeDatum) {\n        return `translate(${(d.x as number) -\n          nodeRadius / 2},${(d.y as number) - nodeRadius / 2})`;\n      });\n    }\n    return () => {\n      simulation.stop();\n      while (svgElement.firstChild) {\n        svgElement.removeChild(svgElement.firstChild);\n      }\n      // TODO remove previous nodes?\n    };\n  }, [width, height, svgElement, graphData]);\n\n  return <svg width={width} height={height} ref={svgRef}></svg>;\n};\n","import { range, alphaName } from \"../utils\";\n\n// export type GraphState = {\n//   nbVertex: number;\n//   scoreMatrix: ScoreMatrix;\n// };\n\nexport type ScoreMatrix = ReadonlyArray<ReadonlyArray<number>>;\n\nexport class GraphState {\n  public static fromEdgeScores(hgs: EdgeScores) {\n    const vertexNameSet = new Set<string>();\n    Object.keys(hgs).forEach(edgeStr => {\n      const [vertex1, vertex2] = parseEdge(edgeStr);\n      vertexNameSet.add(vertex1);\n      vertexNameSet.add(vertex2);\n    });\n    const vertexNames = Array.from(vertexNameSet).sort();\n    type VertexIndexByName = {\n      [vertexName: string]: number;\n    };\n    const vertexIndexByName: VertexIndexByName = vertexNames.reduce(\n      (previous: VertexIndexByName, vertexName, index) => {\n        previous[vertexName] = index;\n        return previous;\n      },\n      {}\n    );\n\n    let state = new GraphState(vertexNames, []);\n    Object.keys(hgs).forEach(edgeStr => {\n      const [vertex1, vertex2] = parseEdge(edgeStr);\n      state = state.withScore100(\n        vertexIndexByName[vertex1],\n        vertexIndexByName[vertex2],\n        hgs[edgeStr]\n      );\n    });\n\n    return state;\n  }\n\n  private constructor(\n    public vertexNames: ReadonlyArray<string>,\n    private readonly scoreMatrix: ScoreMatrix\n  ) {}\n\n  public static createEmpty = (\n    vertexNames: ReadonlyArray<string>\n  ): GraphState => {\n    return new GraphState(vertexNames, []);\n  };\n  public score100(x: number, y: number): number {\n    if (x === y) {\n      return 100;\n    }\n    if (x > y) {\n      return this.score100(y, x);\n    }\n    const row = this.scoreMatrix[x] || [];\n    return row[y] || 0;\n  }\n\n  public score1(x: number, y: number): number {\n    return this.score100(x, y) / 100;\n  }\n\n  public nbVertex() {\n    return this.vertexNames.length;\n  }\n\n  public withNbVertex(nbVertex: number): GraphState {\n    if (nbVertex < this.vertexNames.length) {\n      return this.withVertexNames(this.vertexNames.slice(0, nbVertex));\n    } else {\n      return this.withVertexNames(range(nbVertex).map(alphaName));\n    }\n  }\n  public withVertexNames(vertexNames: string[]): GraphState {\n    return new GraphState(vertexNames, this.scoreMatrix);\n  }\n\n  public vertexName(vertexIndex: number): string {\n    return this.vertexNames[vertexIndex];\n  }\n\n  public withScore100(x: number, y: number, newScore: number): GraphState {\n    if (x === y) {\n      throw new Error(\"Score not modifiable\");\n    }\n    if (x > y) {\n      return this.withScore100(y, x, newScore);\n    } else {\n      try {\n        const matrix = this.scoreMatrix;\n        const normalized = this.normalize(newScore);\n        const newRow = [...(matrix[x] || [])];\n        if (normalized === newRow[y]) {\n          // No change made\n          return this;\n        } else {\n          newRow[y] = normalized;\n          const newScores = [...matrix];\n          newScores[x] = newRow;\n          return new GraphState(this.vertexNames, newScores);\n        }\n      } catch (e) {\n        console.log(e);\n        throw e;\n      }\n    }\n  }\n\n  public withResetedScores(): GraphState {\n    return GraphState.createEmpty(this.vertexNames);\n  }\n\n  public computeConfidenceScore() {\n    const n = this.nbVertex();\n    let confidenceScore = 0;\n\n    for (let x of range(0, n)) {\n      for (let y of range(x + 1, n)) {\n        const newLocal = this.score100(x, y);\n        confidenceScore += newLocal || 0;\n      }\n    }\n    return confidenceScore / ((n * (n - 1)) / 2);\n  }\n\n  private normalize(score: number): number {\n    return Math.max(Math.min(score, 100), 0);\n  }\n\n  public toEdgeScores(): EdgeScores {\n    const edgeScores: EdgeScores = {};\n    const n = this.nbVertex();\n    for (let x of range(0, n)) {\n      for (let y of range(x + 1, n)) {\n        const score = this.score100(x, y);\n        if (score !== 0) {\n          const edgeStr = this.vertexName(x) + \"-\" + this.vertexName(y);\n          edgeScores[edgeStr] = score;\n        }\n      }\n    }\n    return edgeScores;\n  }\n}\n\nexport const isModifiable = (x: number, y: number) => {\n  return x < y;\n};\n\nexport const vertexName = (\n  graphState: GraphState,\n  vertexIndex: number\n): string => {\n  return graphState.vertexName(vertexIndex);\n};\n\ntype EdgeScores = {\n  [edge: string]: number;\n};\n\nconst parseEdge = (edge: string): [string, string] => {\n  const verticesInEdge = edge.split(\"-\");\n  if (verticesInEdge.length !== 2) {\n    throw new Error(\n      \"Invalid edge def \" + edge + \". It must be of form <Node1>-<Node2>\"\n    );\n  }\n  const vertex1 = verticesInEdge[0];\n  const vertex2 = verticesInEdge[1];\n  if (vertex1 === vertex2) {\n    throw new Error(\"Edge def \" + edge + \" uses twice the same node\");\n  }\n  if (vertex1 < vertex2) {\n    return [vertex1, vertex2];\n  } else {\n    return [vertex2, vertex1];\n  }\n};\n","import React from \"react\";\n\nimport { colorForScore, contrastColorForScore } from \"./colorForScore\";\nimport { round2Digits } from \"./utils\";\n\nexport const ScoreDisplay = ({ score }: { score: number }) => (\n  <div\n    style={{\n      display: \"inline-block\",\n      width: \"50px\",\n      textAlign: \"right\",\n      paddingRight: \"8px\",\n      backgroundColor: colorForScore(score),\n      color: contrastColorForScore(score)\n    }}\n  >\n    {round2Digits(score)}\n  </div>\n);\n","import { TextField, Typography } from \"@material-ui/core\";\nimport React, { ChangeEvent } from \"react\";\n\nimport { colorForScore } from \"./colorForScore\";\nimport { GraphState, isModifiable } from \"./state/GraphState\";\nimport { range, round2Digits } from \"./utils\";\nimport { ScoreDisplay } from \"./ScoreBlock\";\n\nexport const GraphStateTable = ({\n  graphState,\n  onGraphStateChange\n}: {\n  graphState: GraphState;\n  onGraphStateChange?: (newState: GraphState) => void;\n}) => (\n  <table>\n    <thead>\n      <tr>\n        <td />\n        {range(graphState.nbVertex()).map(\n          (colIndex: number) =>\n            colIndex >= 1 && (\n              <td key={colIndex}>{graphState.vertexName(colIndex)}</td>\n            )\n        )}\n      </tr>\n    </thead>\n    <tbody>\n      {range(graphState.nbVertex()).map(\n        (rowIndex: number) =>\n          rowIndex < graphState.nbVertex() - 1 && (\n            <tr key={rowIndex}>\n              <td>{graphState.vertexName(rowIndex)}</td>\n              {range(graphState.nbVertex()).map(\n                (colIndex: number) =>\n                  colIndex >= 1 &&\n                  (isModifiable(rowIndex, colIndex) ? (\n                    <td\n                      key={colIndex}\n                      style={{\n                        backgroundColor: colorForScore(\n                          graphState.score100(rowIndex, colIndex)\n                        ),\n                        width: \"50px\"\n                      }}\n                    >\n                      {onGraphStateChange ? (\n                        <TextField\n                          inputProps={{\n                            min: \"0\",\n                            max: \"100\",\n                            step: \"5\",\n                            style: {\n                              textAlign: \"right\"\n                            }\n                          }}\n                          type=\"number\"\n                          value={graphState.score100(rowIndex, colIndex)}\n                          onChange={(e: ChangeEvent<HTMLInputElement>) => {\n                            const newScore = Number(e.target.value);\n                            if (!isNaN(newScore)) {\n                              onGraphStateChange(\n                                graphState.withScore100(\n                                  rowIndex,\n                                  colIndex,\n                                  newScore\n                                )\n                              );\n                            }\n                          }}\n                        />\n                      ) : (\n                        <Typography variant=\"subtitle1\">\n                          <ScoreDisplay\n                            score={graphState.score100(rowIndex, colIndex)}\n                          />\n                        </Typography>\n                      )}\n                    </td>\n                  ) : (\n                    <td key={colIndex}></td>\n                  ))\n              )}\n            </tr>\n          )\n      )}\n    </tbody>\n  </table>\n);\n","import { GraphState } from \"./GraphState\";\nimport { range } from \"../utils\";\nexport type ComputeState = {\n  iterations: GraphState[];\n};\n\nexport const initialState = (initialState: GraphState): ComputeState => ({\n  iterations: [initialState]\n});\n\nexport const computeNextComputeState = (computeState: ComputeState) => {\n  const nextIterationIndex = computeState.iterations.length;\n  const lastIteration = computeState.iterations[nextIterationIndex - 1];\n  return {\n    iterations: [\n      ...computeState.iterations,\n      computeNextIteration(lastIteration, nextIterationIndex - 1)\n    ]\n  };\n};\n\nexport const needsAnotherIteration = (computeState: ComputeState) => {\n  return computeState.iterations.length < computeState.iterations[0].nbVertex();\n};\n\n// Floyd-Warshall algorithm\n// https://en.wikipedia.org/wiki/Floyd–Warshall_algorithm\nconst computeNextIteration = (\n  graphState: GraphState,\n  k: number\n): GraphState => {\n  // Something IS WRONG!!!\n  // http://localhost:3000/?delay=0&edges=%7B%22A-B%22%3A100%2C%22A-C%22%3A100%2C%22A-D%22%3A100%2C%22A-E%22%3A100%2C%22A-F%22%3A100%2C%22A-G%22%3A100%7D\n\n  console.log(\"iteration\" + k);\n  let newState = graphState;\n  for (let i of range(newState.nbVertex())) {\n    for (let j of range(newState.nbVertex())) {\n      const ijScore = newState.score1(i, j);\n      const ikScore = newState.score1(i, k);\n      const kjScore = newState.score1(k, j);\n      const newScore = ikScore * kjScore;\n      if (ijScore < newScore) {\n        // FIXME we should not do rounding hre\n        newState = newState.withScore100(i, j, newScore * 100);\n      }\n    }\n  }\n  console.log(\"graphState\", graphState, \"newGrpahState\", newState);\n  return newState;\n};\n","import { GraphState } from \"../state/GraphState\";\nimport { alphaName, range } from \"../utils\";\n\nexport const EDGES_PARAM = \"edges\";\nexport const graphStateFromUrl = (): GraphState => {\n  const params = new URLSearchParams(window.location.search);\n  if (params.has(EDGES_PARAM)) {\n    try {\n      return GraphState.fromEdgeScores(\n        JSON.parse(params.get(EDGES_PARAM) as string)\n      );\n    } catch (e) {}\n  }\n  return GraphState.createEmpty(range(0, 7).map(alphaName));\n};\n\nexport const DELAY_PARAM = \"delay\";\nexport const delayFromUrl = (): number => {\n  const params = new URLSearchParams(window.location.search);\n  if (params.has(DELAY_PARAM)) {\n    try {\n      return Number(params.get(DELAY_PARAM));\n    } catch (e) {}\n  }\n  return 300;\n};\n\nexport const AUTO_COMPUTE_PARAM = \"auto\";\nexport const autoComputeFromUrl = (): boolean => {\n  const params = new URLSearchParams(window.location.search);\n  if (params.has(AUTO_COMPUTE_PARAM)) {\n    return params.get(AUTO_COMPUTE_PARAM) === \"true\";\n  }\n  return false;\n};\n","import \"./App.css\";\nimport {\n  Button,\n  Checkbox,\n  FormControlLabel,\n  TextField,\n  Typography\n} from \"@material-ui/core\";\nimport React, { ChangeEvent, useEffect } from \"react\";\nimport { ForceGraph } from \"./graph/ForceGraph\";\nimport { GraphStateTable } from \"./GraphStateTable\";\nimport {\n  computeNextComputeState,\n  ComputeState,\n  initialState as createInitialComputeState,\n  needsAnotherIteration\n} from \"./state/ComputeState\";\nimport { GraphState } from \"./state/GraphState\";\nimport {\n  autoComputeFromUrl,\n  delayFromUrl,\n  graphStateFromUrl\n} from \"./url/parseUrl\";\nimport { synchronizeUrl } from \"./url/synchronizeUrl\";\nimport { ScoreDisplay } from \"./ScoreBlock\";\n\nexport default function App() {\n  const [autoCompute, setAutoCompute] = React.useState(autoComputeFromUrl());\n  const [inputState, setInputState] = React.useState<GraphState>(\n    graphStateFromUrl()\n  );\n  const [toCompute, setToCompute] = React.useState<GraphState | null>(\n    autoCompute ? inputState : null\n  );\n  const [delay, setDelay] = React.useState(delayFromUrl());\n  const [computeState, setComputeState] = React.useState<ComputeState | null>(\n    null\n  );\n\n  const handleAutoComputeChange = (autoCompute: boolean): void => {\n    setAutoCompute(autoCompute);\n    if (autoCompute) {\n      setToCompute(inputState);\n    }\n  };\n\n  const handleInputStateChange = (state: GraphState): void => {\n    setInputState(state);\n    if (autoCompute) {\n      setToCompute(state);\n    }\n  };\n\n  useEffect(() => {\n    synchronizeUrl(delay, autoCompute, inputState);\n  }, [inputState, autoCompute, delay]);\n\n  useEffect(() => {\n    if (toCompute === null) {\n      return;\n    }\n    let computeState = createInitialComputeState(toCompute);\n    setComputeState(computeState);\n    let timeoutId: any;\n\n    const iterate = () => {\n      computeState = computeNextComputeState(computeState);\n      setComputeState(computeState);\n\n      if (needsAnotherIteration(computeState)) {\n        timeoutId = setTimeout(iterate, delay);\n      }\n    };\n    if (needsAnotherIteration(computeState)) {\n      timeoutId = setTimeout(iterate, delay);\n    }\n    return () => {\n      clearTimeout(timeoutId);\n    };\n  }, [toCompute, delay]);\n\n  const handleComputeNow = () => {\n    setToCompute(inputState);\n  };\n  return (\n    <div className=\"App\" style={{ display: \"flex\", height: \"1vh\" }}>\n      <div>\n        <Typography variant=\"h5\">Input</Typography>\n        <TextField\n          label=\"Node Count\"\n          type=\"number\"\n          value={inputState.nbVertex()}\n          onChange={(e: ChangeEvent<HTMLInputElement>) => {\n            const nbVertex = Number(e.target.value);\n            if (!isNaN(nbVertex)) {\n              handleInputStateChange(inputState.withNbVertex(nbVertex));\n            }\n          }}\n        />\n        <Button\n          onClick={() => {\n            handleInputStateChange(inputState.withResetedScores());\n          }}\n        >\n          Clear Scores\n        </Button>\n\n        <GraphStateTable\n          graphState={inputState}\n          onGraphStateChange={handleInputStateChange}\n        />\n        <ConfidenceScore\n          confidenceScore={inputState.computeConfidenceScore()}\n        />\n        <pre>{JSON.stringify(inputState.toEdgeScores(), null, \"  \")}</pre>\n        <ForceGraph graphState={inputState}></ForceGraph>\n      </div>\n\n      <div>\n        <Typography variant=\"h5\">New Confidence Score</Typography>\n        <div>\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={autoCompute}\n                onChange={(e: any, checked: boolean) => {\n                  handleAutoComputeChange(checked);\n                }}\n              />\n            }\n            label=\"Auto Compute\"\n          />\n\n          {!autoCompute && (\n            <Button\n              onClick={handleComputeNow}\n              disabled={\n                computeState ? needsAnotherIteration(computeState) : false\n              }\n            >\n              Compute now\n            </Button>\n          )}\n          <TextField\n            label=\"Iteartion Delay\"\n            type=\"number\"\n            disabled={\n              computeState ? needsAnotherIteration(computeState) : false\n            }\n            value={delay}\n            onChange={(e: ChangeEvent<HTMLInputElement>) => {\n              const delay = Number(e.target.value);\n              if (!isNaN(delay)) {\n                setDelay(delay);\n              }\n            }}\n          />\n        </div>\n\n        {computeState &&\n          computeState.iterations.map((_, i) => {\n            const reverseIndex = computeState.iterations.length - i - 1;\n            const iterationState = computeState.iterations[reverseIndex];\n\n            return (\n              <div\n                key={reverseIndex}\n                style={{ display: \"flex\", flexDirection: \"row\" }}\n              >\n                <div>\n                  <Typography variant=\"h6\">Iteration {reverseIndex}</Typography>\n                  <Typography variant=\"subtitle1\">\n                    {reverseIndex === 0\n                      ? \"Input State\"\n                      : \"Using paths through node \" +\n                        iterationState.vertexName(reverseIndex) +\n                        \"\"}\n                  </Typography>\n                  <GraphStateTable graphState={iterationState} />\n\n                  <ConfidenceScore\n                    confidenceScore={iterationState.computeConfidenceScore()}\n                  />\n                </div>\n                <div>\n                  <ForceGraph graphState={iterationState} />\n                </div>\n              </div>\n            );\n          })}\n      </div>\n    </div>\n  );\n}\n\nconst ConfidenceScore = ({ confidenceScore }: { confidenceScore: number }) => (\n  <Typography variant=\"subtitle1\">\n    Confidence Score: <ScoreDisplay score={confidenceScore} />\n  </Typography>\n);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import \"typeface-roboto\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import { GraphState } from \"../state/GraphState\";\nimport { replaceSearchParams, SearchParams } from \"../utils\";\nimport { AUTO_COMPUTE_PARAM, DELAY_PARAM, EDGES_PARAM } from \"./parseUrl\";\n\nexport function synchronizeUrl(\n  delay: number,\n  autoCompute: boolean,\n  inputState: GraphState\n) {\n  const searchParams: SearchParams = {\n    [DELAY_PARAM]: String(delay),\n    [AUTO_COMPUTE_PARAM]: String(autoCompute),\n    [EDGES_PARAM]: JSON.stringify(inputState.toEdgeScores())\n  };\n  const originalHref = window.location.href;\n  const newHref = replaceSearchParams(originalHref, searchParams);\n  if (newHref !== originalHref) {\n    window.history.pushState(\"\", \"Update Params\", newHref);\n  }\n}\n"],"sourceRoot":""}